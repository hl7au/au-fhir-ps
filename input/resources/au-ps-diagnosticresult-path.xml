<?xml version="1.0" encoding="utf-8"?>
<StructureDefinition xmlns="http://hl7.org/fhir">
  <id value="au-ps-diagnosticresult-path"/>
  <extension url="http://hl7.org/fhir/StructureDefinition/structuredefinition-fmm">
    <valueInteger value="0"/>
  </extension>
  <extension url="http://hl7.org/fhir/StructureDefinition/structuredefinition-compliesWithProfile">
    <valueCanonical value="http://hl7.org.au/fhir/core/StructureDefinition/au-core-diagnosticresult-path"/>
  </extension>
  <extension url="http://hl7.org/fhir/StructureDefinition/structuredefinition-compliesWithProfile">
    <valueCanonical value="http://hl7.org/fhir/uv/ips/StructureDefinition/Observation-results-laboratory-pathology-uv-ips"/>
  </extension>
  <url value="http://hl7.org.au/fhir/ps/StructureDefinition/au-ps-diagnosticresult-path"/>
  <name value="AUPSPathologyResult"/>
  <title value="AU PS Pathology Result Observation"/>
  <status value="draft"/>
  <description value="This profile sets minimum expectations for an Observation resource that represents a pathology result associated with a patient in the context of a patient summary in an Australian context. It is based on the [AU Base Pathology Result](https://build.fhir.org/ig/hl7au/au-fhir-base/StructureDefinition-au-pathologyresult.html) profile, and applies the constraints of [AU Core Pathology Result Observation](https://build.fhir.org/ig/hl7au/au-fhir-core/StructureDefinition-au-core-diagnosticresult-path.html) and [Observation Results - Laboratory/Pathology (IPS)](https://build.fhir.org/ig/HL7/fhir-ips/StructureDefinition-Observation-results-laboratory-pathology-uv-ips.html)."/>
  <kind value="resource"/>
  <abstract value="false"/>
  <type value="Observation"/>
  <baseDefinition value="http://hl7.org.au/fhir/StructureDefinition/au-pathologyresult"/>
  <derivation value="constraint"/>
  <differential>
    <element id="Observation">
      <path value="Observation"/>
      <constraint>
        <key value="au-core-obs-01"/>
        <severity value="error"/>
        <human value="If there is no component or hasMember element then at least value or data absent reason shall be present"/>
        <expression value="(component.empty() and hasMember.empty()) implies (dataAbsentReason.exists() or value.exists())"/>
      </constraint>
      <constraint>
        <key value="ips-2"/>
        <severity value="error"/>
        <human value="At least one of these Observation elements shall be provided: &quot;value &quot;,  &quot;dataAbsentReason &quot;,  &quot;hasMember &quot; or  &quot;component &quot;"/>
        <expression value="value.exists() or hasMember.exists() or component.exists() or dataAbsentReason.exists()"/>
      </constraint>
      <constraint>
      <key value="ips-3"/>
        <severity value="error"/>
        <human value="If observation has components, at least one of these Observation.component elements shall be provided: &quot;value&quot;, or &quot;dataAbsentReason &quot;"/>
        <expression value="component.exists() implies (component.value.exists() or component.dataAbsentReason.exists())"/>
      </constraint>
    </element>
    <element id="Observation.status">
      <path value="Observation.status"/>
      <binding>
        <strength value="required"/>
        <valueSet value="http://hl7.org/fhir/uv/ips/ValueSet/results-status-uv-ips"/>
      </binding>
      <mustSupport value="true"/>
    </element>
    <element id="Observation.category">
      <path value="Observation.category"/>
      <type>
        <code value="CodeableConcept"/>
        <profile value="http://hl7.org/fhir/uv/ips/StructureDefinition/CodeableConcept-uv-ips"/>
      </type>
      <mustSupport value="true"/>
    </element>
    <element id="Observation.category:lab">
      <path value="Observation.category"/>
      <sliceName value="lab"/>
      <short value="Observation generated by laboratories"/>
      <min value="1"/>
      <max value="1"/>
      <mustSupport value="true"/>
    </element>
    <!--<element id="Observation.category:lab.coding">
      <path value="Observation.category.coding"/>
      <min value="1"/>
    </element>
    <element id="Observation.category:lab.coding.system">
      <path value="Observation.category.coding.system"/>
      <min value="1"/>
      <fixedUri value="http://terminology.hl7.org/CodeSystem/observation-category"/>
    </element>
    <element id="Observation.category:lab.coding.code">
      <path value="Observation.category.coding.code" />
      <min value="1" />
      <fixedCode value="laboratory" />
    </element>-->
    <element id="Observation.category:specificDiscipline">
      <path value="Observation.category"/>
      <sliceName value="specificDiscipline"/>
      <short value="Specific discipline of pathology"/>
      <binding>
        <strength value="extensible"/>
        <valueSet value="https://healthterminologies.gov.au/fhir/ValueSet/pathology-diagnostic-service-category-1"/>
      </binding>
      <mustSupport value="true"/>
    </element>
    <!-- <element id="Observation.category:specificDiscipline.coding.system">
      <path value="Observation.category.coding.system"/>
      <min value="1"/>
      <fixedUri value="http://terminology.hl7.org/CodeSystem/v2-0074"/>
    </element>-->
    <element id="Observation.code">
      <path value="Observation.code"/>
      <type>
        <code value="CodeableConcept"/>
        <profile value="http://hl7.org/fhir/uv/ips/StructureDefinition/CodeableConcept-uv-ips"/>
      </type>
      <binding>
        <strength value="extensible" />
        <valueSet value="https://healthterminologies.gov.au/fhir/ValueSet/spia-pathology-reporting-1" />
      </binding>
      <mustSupport value="true"/>
    </element>
    <element id="Observation.subject">
      <path value="Observation.subject"/>
      <type>
        <code value="Reference"/>
        <targetProfile value="http://hl7.org.au/fhir/ps/StructureDefinition/au-ps-patient"/>
      </type>
      <mustSupport value="true"/>
    </element>
    <element id="Observation.subject.reference">
      <path value="Observation.subject.reference"/>
      <min value="1"/>
      <mustSupport value="true"/>
    </element>
    <element id="Observation.effective[x]">
      <path value="Observation.effective[x]"/>
      <condition value="au-core-obs-02"/>
      <constraint>
        <key value="au-core-obs-02"/>
        <severity value="error"/>
        <human value="Date shall be at least to day or, if not available, the Data Absent Reason extension shall be present"/>
        <expression value="(($this is dateTime implies $this.toString().length() >= 10) and extension('http://hl7.org/fhir/StructureDefinition/data-absent-reason').value.exists().not()) xor ($this is dateTime implies ($this.hasValue().not() and extension('http://hl7.org/fhir/StructureDefinition/data-absent-reason').value.exists()))"/>
      </constraint>
      <type>
        <code value="dateTime"/>
      </type>
      <type>
        <code value="Period"/>
      </type>
      <mustSupport value="true"/>
    </element>
    <element id="Observation.performer">
      <path value="Observation.performer"/>
      <min value="1"/>
      <type>
        <code value="Reference"/>
        <targetProfile value="http://hl7.org.au/fhir/ps/StructureDefinition/au-ps-practitioner" />
        <targetProfile value="http://hl7.org.au/fhir/ps/StructureDefinition/au-ps-practitionerrole"/>
        <targetProfile value="http://hl7.org.au/fhir/ps/StructureDefinition/au-ps-organization"/>
        <targetProfile value="http://hl7.org.au/fhir/ps/StructureDefinition/au-ps-patient"/>
        <targetProfile value="http://hl7.org.au/fhir/ps/StructureDefinition/au-ps-relatedperson"/>
      </type>
      <mustSupport value="true"/>
    </element>
    <element id="Observation.value[x]">
      <path value="Observation.value[x]"/>
      <condition value="au-core-obs-01"/>
      <type>
        <extension url="http://hl7.org/fhir/StructureDefinition/elementdefinition-type-must-support">
          <valueBoolean value="true" />
        </extension>
        <code value="Quantity"/>
      </type>
      <type>
        <extension url="http://hl7.org/fhir/StructureDefinition/elementdefinition-type-must-support">
          <valueBoolean value="true" />
        </extension>
        <code value="CodeableConcept"/>
        <profile value="http://hl7.org/fhir/uv/ips/StructureDefinition/CodeableConcept-uv-ips"/>
      </type>
      <type>
        <extension url="http://hl7.org/fhir/StructureDefinition/elementdefinition-type-must-support">
          <valueBoolean value="true" />
        </extension>
        <code value="string"/>
      </type>
      <type>
        <code value="boolean"/>
      </type>
      <type>
        <code value="integer"/>
      </type>
      <type>
        <code value="Range"/>
      </type>
      <type>
        <code value="Ratio"/>
      </type>
      <type>
        <code value="SampledData"/>
      </type>
      <type>
        <code value="time"/>
      </type>
      <type>
        <code value="dateTime"/>
      </type>
      <type>
        <code value="Period"/>
      </type>
      <mustSupport value="true"/>
    </element>
    <element id="Observation.dataAbsentReason">
      <path value="Observation.dataAbsentReason"/>
      <condition value="au-core-obs-01"/>
      <mustSupport value="true"/>
    </element>
    <element id="Observation.interpretation">
      <path value="Observation.interpretation"/>
      <type>
        <code value="CodeableConcept"/>
        <profile value="http://hl7.org/fhir/uv/ips/StructureDefinition/CodeableConcept-uv-ips"/>
      </type>
      <mustSupport value="true"/>
    </element>
    <element id="Observation.specimen">
      <path value="Observation.specimen"/>
      <mustSupport value="true"/>
    </element>
    <element id="Observation.referenceRange">
      <path value="Observation.referenceRange"/>
      <mustSupport value="true"/>
    </element>
    <element id="Observation.referenceRange.low">
      <path value="Observation.referenceRange.low"/>
      <mustSupport value="true"/>
    </element>
    <element id="Observation.referenceRange.high">
      <path value="Observation.referenceRange.high"/>
      <mustSupport value="true"/>
    </element>
    <element id="Observation.referenceRange.type">
      <path value="Observation.referenceRange.type"/>
      <mustSupport value="true"/>
    </element>
    <element id="Observation.referenceRange.text">
      <path value="Observation.referenceRange.text"/>
      <mustSupport value="true"/>
    </element>
    <element id="Observation.hasMember">
      <path value="Observation.hasMember"/>
      <short value="Individual observations in a group, study, or panel"/>
      <type>
        <code value="Reference"/>
        <targetProfile value="http://hl7.org.au/fhir/ps/StructureDefinition/au-ps-diagnosticresult-path"/>
      </type>
      <mustSupport value="true"/>
    </element>
    <element id="Observation.component">
      <path value="Observation.component"/>
      <constraint>
        <key value="au-core-obs-03"/>
        <severity value="error"/>
        <human value="The component shall at least have a value or a data absent reason"/>
        <expression value="value.exists() or dataAbsentReason.exists()"/>
      </constraint>
      <mustSupport value="true"/>
    </element>
    <element id="Observation.component.code">
      <path value="Observation.component.code"/>
      <binding>
        <strength value="extensible" />
        <valueSet value="https://healthterminologies.gov.au/fhir/ValueSet/spia-pathology-reporting-1" />
      </binding>
      <mustSupport value="true"/>
    </element>
    <element id="Observation.component.value[x]">
      <path value="Observation.component.value[x]"/>
      <condition value="au-core-obs-03"/>
      <mustSupport value="true"/>
    </element>
    <element id="Observation.component.dataAbsentReason">
      <path value="Observation.component.dataAbsentReason"/>
      <condition value="au-core-obs-03"/>
      <mustSupport value="true"/>
    </element>
  </differential>
</StructureDefinition>
